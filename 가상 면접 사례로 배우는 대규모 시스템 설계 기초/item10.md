# item10. 알림 시스템 설계
## 1. 문제 이해 및 설계 범위 확정
예시)
- 푸시 알림, SMS, 이메일
- soft real-time
- ios, 안드로이드, 랩탑/데스크탑
- 클라이언트/서버 가 알림 생성
- opt-out(알림 안받게 설정) 가능

## 2. 개략적 설계안 제시 및 동의 구하기
- 알림 유형별 지원 방안
- 연락처 정보 수집 절차
- 알림 전송 및 수신 절차

### 알림 유형별 지원 방안
#### 공통
- 알림 제공자(provider): 알림 요청을 만들어 각 푸시알림서비스에 보내는 주체

#### 각 환경별 푸시알림서비스
- 애플: APNS
- 안드로이드: FCM
- SMS: SMS 상용 서비스
- 이메일: 이메일 상용 서비스

### 연락처 정보 수집 절차
모바일 단말 토큰, 전화번호, 이메일 주소 등의 정보 필요

### HTML 다운로더
알림 전송 및 수신 절차
1. 각 서비스들이 알림 시스템(단일 서버)을 호출
2. 알림 시스템은 각 서비스의 단말에 맞는 푸시알림서비스 호출
3. 각 푸시 알림 서비스는 각 단말에 맞는 알리믈 전송해야 하며, 확장성이 중요함

#### 단점
- 단일 서버인 알림 시스템에 대해 SPOF가 발생함
- 단일 서버이기 때문에, 확장성이 어려움
- 단일 서버이기 때문에, 병목 현상이 생김

#### 보완
1. db와 캐시를 알림 시스템의 주 서버에서 분리
2. 알림 서버 증설 및 수평적 규모 확장
3. 메시지 큐를 이용

## 3. 상세 설계
### 안정성
- 분산 환경에서 운영될 알림 시스템을 설계할 때는, 안정성을 확보하기 위한 사항이 고려되어야 함
  - 데이터 손실 방지
    - 알림 데이터를 db에 보관하고, 재시도 메커니즘을 구현해야 함
  - 알림 중복 전송 방지
    - 분산 시스템의 특성 상, 같은 알림이 중복되어 전송이 될 수 있음.
    - 중복 탐지 메커니즘을 도입해야 함
      - 예) 보내야 할 알림이 도착하면, 그 이벤트 ID를 검사하여, 이전에 있는 ID라면 버림
  - 추가로 필요한 컴포넌트 및 고려사항
    - 알림 템플릿
    - 알림 설정
    - 전송률 제한
    - 재시도 방법
    - 푸시 알림과 보안
    - 큐 모니터링
    - 이벤트 추적

## 4. 마무리
- 안정성: 메시지 전송 실패율을 낮추기 위해 아정적인 재시도 메커니즘을 도입
- 보안: 인증된 클라이언트만이 알림을 보낼 수 있어야 함
- 이벤트 추적 및 모니터링
- 사용자 설정
- 전송률 제한
