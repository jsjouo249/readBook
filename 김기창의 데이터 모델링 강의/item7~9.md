# TIL (2025.08.13)

오늘 읽은 범위: 7강 - 단순해 보이는 관계의 실제 정의 ~ 9강 - 변경 이력 데이터를 생성하는 방법

---

```text
책의 내용을 요약해보기
```
# 7강 - 단순해 보이는 관계의 실제 정의
관계형 데이터베이스의 핵심 원리는 데이터를 중복하지 않고, 힌 군데서만 관리하고, 필요할 때 연결해서 사용하는 것

## 엔터티 간의 연관성이란?
모델링에서의 관계 => 직접적이고 실제적인 관계

업무 요건이 연관성을 관계로 승격시키는 기준

## 관리하려는 관계인가?
1. 관리하려는 관계냐?
2. 특정한 관계는 분명 존재하는데, 데이터로 관리할지? - 업무요건

### 관리하려는 관계인지 판단하는 기준은 업무
ㄴ 판단 기준은 조인

조인을 하려면, 속성이 필요하고, 그 속성은 외래 식별자 === FK === 관계 속성

## 참조 무결성 관계인가?
### 참조 무결성 관계 
ㄴ 두 엔터티 사이의 연관성인데, 조인으로 연결되는 연관성

### 참조 무결성 제약
ㄴ 참조 무결성을 DB에서 강제하도록 하는 물리적 제약

## 1차 관계인가?
### 관계는 바로 위의 상위 엔터티와의 관계만으로 설계해야 한다. === 관계는 1촌 관계여야 한다.
ㄴ 1촌 관계 === 직접 관계  
ㄴ 2촌 관계 === 간접 관계

### 강한 표현 ---------------------------------------> 약한 표현  
### 관계는 직접 관계인 1차 관계여야 한다 > 관계는 조인할 수 있어야 한다 | 관계는 참조 무결성이여야 한다 

2차 이상의 관계는 추출관계 == 중복 관계
ㄴ 성능 문제 때문에, 바로 조인하기 위해 없어도 되는 추출 관계를 관리하는 것

### 관계 도출 과정
```
관리하려는 관계인가?   -yes-> 참조 무결성 관계인가? -yes-> 1차 관계인가? -yes-> 관계선 표현 ㄱ   
                  ㄴ----------------------ㅗ-----------------ㅗ-----관계 아님--
```

## 관계선 표기법의 핵심. 관계비
한쪽 엔터티를 기준으로 그 엔터티의 하나의 인스턴스가 다른 엔터티의 인스턴스 몇 개와 연관돼 있는지를 의미 === 까마귀발
- 동그라미: 하나도 없다
- 세로선: 하나가 있다
- 대각선: 여러개가 있다
- 점선의 원: 없을 수도 있고, 있을 수 도 있다.

## 관계 존재성과 속성의 널 제약
관계 존재성은 상대 엔터티에 값이 있냐 없냐를 의미 ==> 존재 여부를 의미  
참고)null값도 값은 존재하는 것

## 모델링의 기본 이론을 마치면서
- 관계썬의 실상은 속성이며, 관계썬은 참조 무결성 제약으로 생성해서 실체화
- 관계는 양쪽 엔터티가 명확해야 의미가 있음
- 엔터티를 설계할 때 관계는 제외하고, 데이터 본질만을 고려해서 설계해야 한다.
- 데이터 본질과 관계를 하나의 엔터티로 설계하면 안된다.


# 8강 - 발생 내역이 아니라 변경 이력이야!
## 이력 데이터란?
보통의 이력: 지금까지의 학업, 직업, 경험 등의 내력을 의미하며, 영어로는 history, list임.

### 모델링에서의 이력의 영문은 alternation으로, 변경과 연관돼 있음.
데이터를 업데이트 하면서 끝나면, 이력 데이터 관리는 불필요.  
데이터가 업데이트 되면서, 이전의 데이터 관리가 필요하면, 이력 데이터 관리 필요.

과거 데이터라서 변경 이력 데이터인 것이 아닌, 변경돼서 변경 이력 데이터

## 변경 데이터란?
이미 존재하는게 변해야 변경 / 존재하지 않는 상태에서는 생성

대부분의 행위 엔터티는 발생 내역 엔터티

## 존재하는 인스턴스가 변경된다는 것은?
이미 존재하는 인스턴스가 변경된다는 건 그 인스턴스에 해당하는 속성의 값이 변경된다는 것을 의미 === 인스턴스 자체를 나타내는 주 식별자는 그대로 존재해야 함

## 원천 엔터티의 중요성
데이터가 변경 데이터인지를 판단할 때의 기준이 주 식별자라는 것
따라서, 변경 이력 데이터를 분석하거나 설계하기 전에 먼저 원천 엔터티부터 설계해야 함.

## 원천 엔터티에 변경 이력 엔터티를 혼합
원천 데이터와 변경 데이터를 합쳐서 생각하거나 설계하지 않는 것이 바람직

단, 혼합하는 경우가 있는데, 두 데이터를 동시에 자주 사용할 때

## 관리하기 매우 어려운 선분 이력
### 선분 이력은 성능 문제가 있을 때만 사용하는게 원칙
1. 원천 엔터티를 설계
2. 변경 이력 데이터를 관리하는 요건
3. 최적의 이력 유형을 선택하여 이력 엔터티 설계
4. 성능 문제가 존재할 경우
5. 선분 이력 방법 채택

선분 이력 방식에는 치명적인 무제점이 존재.  
유효 시작 일자와 유효 종료 일자를 연결하면, 반드시 선분이 되도록 만들어야 한다는 것  
선분이 되지 않으면, 잘못된 결과가 나옴

### 주 식별자 값이 달라지면서 쌓이는 발생 내역과 주 식별자에 속한 속성 값이 변경되는 변경 이력을 구분하는 게 가장 중요
### 이력 데이터를 설계하려면, 원천 데이터부터 설계
### 선분 이력은 성능 문제가 있을 때만 고려

# 9강 - 변경 이력 데이터를 생성하는 방법
## 변경 이력 엔터티 설계 시점
이력 엔터티 설계 시점
1. 원천 엔터리를 설계할 때, 이력 엔터티도 동시에 설계  
ㄴ 원천 엔터티에 대한 설계가 혼란스러울 수 있다.
2. 이력 엔터티는 후반에 기간을 정해서 별도로 설계  
ㄴ 이력 데이터 관리 방법에 따라 모델링 구조가 바뀔 수 있어서, 사용되지 않음

## 이력 데이터 설계 방법
1. 엔터티 단위로 설계  
ㄴ 속성 값이 하나라도 변경되면, 변경 전의 전체 속성을 이력 엔터티에서 관리 === 스냅샷 데이터
2. 속성 단위로 설계  
ㄴ 변경된 속성의 데이터만을 별도로 관리하는 방법

응용 방법: 속성의 묶음 단위로 설계하는 방법  
ㄴ 내용이 유사하거나 같이 사용될 수 있는 속성을 묶어서 별도의 엔터티에서 이력 데이터를 관리

```
유형1. 엔터티 단위로 관리하면서 별도의 엔터티로 설계
- 모든 속성 값을 관리하면서, 언제 변경된 것인지 알 수 있음

행위 엔터티에 대한 이력 데이터를 설계할 때는 주의할 부분이 존재.  
행위 엔터티의 하위 엔터티가 종속 관계로 연결되어 있을 때  
ㄴ 관계가 존재한다 === 같이 조회된다 === 데이터 간에 종속성이 존재한다  
ㄴ 이력 데이터도 종속성이 유지되어야 한다.

- 장점: 원천 데이터를 설계한 후에 이력 데이터를 설계하기 때문에, 명확하게 설계 가능, 이력 데이터 생성 쉬움
- 단점: 이력 데이터를 인스턴스 단위로 관리하므로, 값이 변경된 속성이 무엇인지 알기 어렵다.
- 이 방법을 쓰는 경우: 원천과 이력이 같이 사용될 일이 드물 때, 변경 시점의 전체 속성에 대한 값을 보여줄 때


유형2. 엔터티 단위로 관리하면서 같은 엔터티로 설계
이력 데이터를 의미하는 인스턴스가 포함되어야 하니, 원래 설계의 주 식별자에 변경 일자 같은 식별자가 추가되어야 함
- 장점: 데이터 관리 편하다
- 단점: 엔터티의 성격이 불명확, 하나의 엔터티에 조회 집중
- 설계의 전제조건: 하위 엔터티가 존재하지 않아야 함

유형3. 종 테이블에서 이력 데이터를 통합 관리하도록 설계
원천 엔터티에서 변경된 속성을 종 테이블(vertical table) 형식의 별도 엔터티에서 통합 관리하도록 설계
ㄴ 종 테이블은 변경된 속성 값만 관리

- 중요한 점: 종 테이블에서 이력 설계 대상 속성을 기준 정보로서 관리해야 한다는 점.
- 장점: 유연한 구조 모델
- 단점: 모델 구조가 데이터 속으로 사라짐
```


```text
🤔 오늘 읽은 소감은? 떠오르는 생각을 가볍게 적어보세요
```
선분 이력 방식, 종 테이블 등 생소한 개념이 많았다...


```text
💡 궁금한 내용이 있거나, 잘 이해되지 않는 내용이 있다면 적어보세요.
```
선분 이력 방식과 그냥 이력 데이터를 쌓는 것에 대한 차이 인데, 의미가 있나 선분 이력 방식이??